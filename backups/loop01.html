<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Channel Looper</title>
</head>
<body>
<h2>Music Multi Channel Javascript Looper</h2>

<div>
    <input type="button" value="Play All Channels" onclick="playAllChannels()">
    <input type=button value="Stop All Audio" onclick="stopAllAudio()">
</div>
<br>
    
<div>
    <input type="text" id="myName1" size=10 value="Channel1.mp3">
    <input id="myStart1" type="button" value="Record Channel 1" onclick="{
        document.getElementById('myStart1').style.backgroundColor = 'red';
        document.getElementById('myStop1').style.backgroundColor  = 'gray';
        startRecording(1);
    }">
    <input id="myStop1"  type="button"value="Stop Channel 1" onclick="{
        document.getElementById('myStart1').style.backgroundColor = 'gray';
        document.getElementById('myStop1').style.backgroundColor  = 'green';
        stopRecording(1, 'myName1');
    }">    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[1].loop = false;
            this.value = 'Once';
        } else {
            audioElements[1].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(1, event)">
    <audio id="audio1" controls></audio>
    <a id="download1" style="display: none;">Download Channel 1</a>
</div>

    <div>
    <input type="text" id="myName2" size=10 value="Channel2.mp3">
    <input id="myStart2" type="button" value="Record Channel 2" onclick="{
        document.getElementById('myStart2').style.backgroundColor = 'red';
        document.getElementById('myStop2').style.backgroundColor  = 'gray';
        startRecording(2);
    }">
    <input id="myStop2"  type="button"value="Stop Channel 2" onclick="{
        document.getElementById('myStart2').style.backgroundColor = 'gray';
        document.getElementById('myStop2').style.backgroundColor  = 'green';
        stopRecording(2, 'myName2');
    }">    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[2].loop = false;
            this.value = 'Once';
        } else {
            audioElements[2].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(2, event)">
    <audio id="audio2" controls></audio>
    <a id="download2" style="display: none;">Download Channel 2</a>
</div>





  
<div>
    <input type="text" id="myName3" size=10 value="Channel3.mp3">
    <input id="myStart3" type="button" value="Record Channel 3" onclick="{
        document.getElementById('myStart3').style.backgroundColor = 'red';
        document.getElementById('myStop3').style.backgroundColor  = 'gray';
        startRecording(3);
    }">
    <input id="myStop3"  type="button"value="Stop Channel 3" onclick="{
        document.getElementById('myStart3').style.backgroundColor = 'gray';
        document.getElementById('myStop3').style.backgroundColor  = 'green';
        stopRecording(3, 'myName3');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[3].loop = false;
            this.value = 'Once';
        } else {
            audioElements[3].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(3, event)">
    <audio id="audio3" controls></audio>
    <a id="download3" style="display: none;">Download Channel 3</a>
</div>




  
  
<div>
    <input type="text" id="myName4" size=10 value="Channel4.mp3">
    <input id="myStart4" type="button" value="Record Channel 4" onclick="{
        document.getElementById('myStart4').style.backgroundColor = 'red';
        document.getElementById('myStop4').style.backgroundColor  = 'gray';
        startRecording(4);
    }">
    <input id="myStop4"  type="button"value="Stop Channel 4" onclick="{
        document.getElementById('myStart4').style.backgroundColor = 'gray';
        document.getElementById('myStop4').style.backgroundColor  = 'green';
        stopRecording(4, 'myName4');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[4].loop = false;
            this.value = 'Once';
        } else {
            audioElements[4].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(4, event)">
    <audio id="audio4" controls></audio>
    <a id="download4" style="display: none;">Download Channel 4</a>
</div>





  
  
<div>
    <input type="text" id="myName5" size=10 value="Channel5.mp3">
    <input id="myStart5" type="button" value="Record Channel 5" onclick="{
        document.getElementById('myStart5').style.backgroundColor = 'red';
        document.getElementById('myStop5').style.backgroundColor  = 'gray';
        startRecording(5);
    }">
    <input id="myStop5"  type="button"value="Stop Channel 5" onclick="{
        document.getElementById('myStart5').style.backgroundColor = 'gray';
        document.getElementById('myStop5').style.backgroundColor  = 'green';
        stopRecording(5, 'myName5');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[5].loop = false;
            this.value = 'Once';
        } else {
            audioElements[5].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(5, event)">
    <audio id="audio5" controls></audio>
    <a id="download5" style="display: none;">Download Channel 5</a>
</div>






  


  
  
  
<div>
    <input type="text" id="myName6" size=10 value="Channel6.mp3">
    <input id="myStart6" type="button" value="Record Channel 6" onclick="{
        document.getElementById('myStart6').style.backgroundColor = 'red';
        document.getElementById('myStop6').style.backgroundColor  = 'gray';
        startRecording(6);
    }">
    <input id="myStop6"  type="button"value="Stop Channel 6" onclick="{
        document.getElementById('myStart6').style.backgroundColor = 'gray';
        document.getElementById('myStop6').style.backgroundColor  = 'green';
        stopRecording(6, 'myName6');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[6].loop = false;
            this.value = 'Once';
        } else {
            audioElements[6].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(6, event)">
    <audio id="audio6" controls></audio>
    <a id="download6" style="display: none;">Download Channel 6</a>
</div>






  


  
  
  
<div>
    <input type="text" id="myName7" size=10 value="Channel7.mp3">
    <input id="myStart7" type="button" value="Record Channel 7" onclick="{
        document.getElementById('myStart7').style.backgroundColor = 'red';
        document.getElementById('myStop7').style.backgroundColor  = 'gray';
        startRecording(7);
    }">
    <input id="myStop7"  type="button"value="Stop Channel 7" onclick="{
        document.getElementById('myStart7').style.backgroundColor = 'gray';
        document.getElementById('myStop7').style.backgroundColor  = 'green';
        stopRecording(7, 'myName7');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[7].loop = false;
            this.value = 'Once';
        } else {
            audioElements[7].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(7, event)">
    <audio id="audio7" controls></audio>
    <a id="download7" style="display: none;">Download Channel 7</a>
</div>






  


  
  
  
<div>
    <input type="text" id="myName8" size=10 value="Channel8.mp3">
    <input id="myStart8" type="button" value="Record Channel 8" onclick="{
        document.getElementById('myStart8').style.backgroundColor = 'red';
        document.getElementById('myStop8').style.backgroundColor  = 'gray';
        startRecording(8);
    }">
    <input id="myStop8"  type="button"value="Stop Channel 8" onclick="{
        document.getElementById('myStart8').style.backgroundColor = 'gray';
        document.getElementById('myStop8').style.backgroundColor  = 'green';
        stopRecording(8, 'myName8');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[8].loop = false;
            this.value = 'Once';
        } else {
            audioElements[8].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(8, event)">
    <audio id="audio8" controls></audio>
    <a id="download8" style="display: none;">Download Channel 8</a>
</div>






  


  
  
  
<div>
    <input type="text" id="myName9" size=10 value="Channel9.mp3">
    <input id="myStart9" type="button" value="Record Channel 9" onclick="{
        document.getElementById('myStart9').style.backgroundColor = 'red';
        document.getElementById('myStop9').style.backgroundColor  = 'gray';
        startRecording(9);
    }">
    <input id="myStop9"  type="button"value="Stop Channel 9" onclick="{
        document.getElementById('myStart9').style.backgroundColor = 'gray';
        document.getElementById('myStop9').style.backgroundColor  = 'green';
        stopRecording(9, 'myName9');
    }">
    
    <input type="button" value="Once" onclick="{
        if (this.value == 'Loop') {
            audioElements[9].loop = false;
            this.value = 'Once';
        } else {
            audioElements[9].loop = true;
            this.value = 'Loop';
        }
    }"><br>
    <input type="file" accept="audio/mp3" onchange="loadFile(9, event)">
    <audio id="audio9" controls></audio>
    <a id="download9" style="display: none;">Download Channel 9</a>
</div>






  


  

  


  
    
<div>
    <input type="button" value="Play All Channels" onclick="playAllChannels()">
    <input type=button value="Stop All Audio" onclick="stopAllAudio()">
</div>

<script>
    
let timers = {};  // Keeps track of timers for different channels
let myLatestValue = ''
let myLatestCount = 0;
    
const mediaRecorders = {};
const audioChunks = {};
const audioElements = {
    1: document.getElementById('audio1'),
    2: document.getElementById('audio2'),
    3: document.getElementById('audio3'),
    4: document.getElementById('audio4'),
    5: document.getElementById('audio5'),
    6: document.getElementById('audio6'),
    7: document.getElementById('audio7'),
    8: document.getElementById('audio8'),
    9: document.getElementById('audio9')
};
const downloadLinks = {
    1: document.getElementById('download1'),
    2: document.getElementById('download2'),
    3: document.getElementById('download3'),
    4: document.getElementById('download4'),
    5: document.getElementById('download5'),
    6: document.getElementById('download6'),
    7: document.getElementById('download7'),
    8: document.getElementById('download8'),
    9: document.getElementById('download9')
};

function startRecording(channel) {
    navigator.mediaDevices.getUserMedia({ 
    audio: {
               sampleRate: 48000, // Higher sample rates might capture more detail
               noiseSuppression: true, // Helps reduce background noise
               echoCancellation: true // Useful if the recording environment has echo issues
          }
    })
    .then(stream => {
        mediaRecorders[channel] = new MediaRecorder(stream);
        audioChunks[channel] = [];

        mediaRecorders[channel].ondataavailable = event => {
            audioChunks[channel].push(event.data);
        };

        mediaRecorders[channel].start();
        
        // Start the timer
        startTimer(channel);
        console.log('started');
    })
    .catch(error => {
        console.error("Error accessing media devices.", error);
    });
}

function stopRecording(channel, myFileName) {
    mediaRecorders[channel].stop();
    mediaRecorders[channel].onstop = () => {
        const audioBlob = new Blob(audioChunks[channel], { type: 'audio/mp3' });
        const audioUrl = URL.createObjectURL(audioBlob);
        audioElements[channel].src = audioUrl;

        const fileName = document.getElementById(myFileName).value;
        downloadLinks[channel].href = audioUrl;
        downloadLinks[channel].download = fileName;
        downloadLinks[channel].style.display = 'inline';
        downloadLinks[channel].textContent = `Download ${fileName}`;

        delete mediaRecorders[channel];
        delete audioChunks[channel];

        // Stop the timer
        stopTimer(channel);
    };
}



  function loadFile(channel, event) {
    const file = event.target.files[0];
    if (file) {
        const fileUrl = URL.createObjectURL(file);
        audioElements[channel].src = fileUrl;

        // Set the download link
        downloadLinks[channel].href = fileUrl;
        downloadLinks[channel].download = file.name;
        downloadLinks[channel].style.display = 'inline';

        // Update the link text to reflect the new file name
        downloadLinks[channel].textContent = `Download ${file.name}`; // Updates the link text

        // Update the text box with the uploaded file's name
        const textBoxId = `myName${channel}`;  // Assumes your text box IDs are formatted as 'myName1', 'myName2', etc.
        document.getElementById(textBoxId).value = file.name;
    }
}


function playAllChannels() {
    Object.values(audioElements).forEach(audio => {
        if (!audio.paused) {
            audio.pause();
            audio.currentTime = 0;
        }
        audio.play();
    });
}


    function stopAllAudio() {
    const audios = [1, 2, 3, 4, 5, 6, 7, 8, 9]; // Array of audio element IDs suffixes
    audios.forEach(num => {
        const audioPlayer = document.getElementById('audio' + num);
        if (audioPlayer) {
            audioPlayer.pause();
            audioPlayer.currentTime = 0;
        }
    });
}




function startTimer(channel) {
    let count = 0;
    const buttonId = 'myStart' + channel;
    const button = document.getElementById(buttonId);
    myLatestValue = button.value
    button.value = myLatestValue +', ' + count + ':00 s';  // Initialize button label

    timers[channel] = setInterval(() => {
        count++;
        myLatestCount = count
        button.value = myLatestValue +', ' + count + ':00 s';  // Update the button label every second
        //console.log(button.value)
    }, 1000);
}

function stopTimer(channel) {
    clearInterval(timers[channel]);  // Stop the timer
    const buttonId = 'myStart' + channel;
    const button = document.getElementById(buttonId);
    button.value = myLatestValue +', ' + myLatestCount + ':00 s';  // Reset button label
}
    
</script>

<h6>Use at your own risk<br>
Github at <a href="https://github.com/hpssjellis/recording-js-looper"> https://github.com/hpssjellis/recording-js-looper</a><br>
By Jeremy Ellis   at <a href="https://ca.linkedin.com/in/jeremy-ellis-4237a9bb">LinkedIn</a>

</h6>
    
    
    
</body>
</html>
